# Friend-Lite Docker Compose
# Root compose file using modular includes
#
# Usage:
#   Development:  docker compose up
#   With Mycelia:  docker compose --profile mycelia up
#   With HTTPS:    docker compose --profile https up
#   Testing:       docker compose -f docker-compose.yml -f compose/overrides/test.yml up
#   Production:    docker compose -f docker-compose.yml -f compose/overrides/prod.yml up
#
# Structure:
#   compose/backend.yml           - Backend API and workers
#   compose/frontend.yml          - Web UI
#   compose/overrides/            - Environment-specific overrides

include:
  # Application services (always included)
  - compose/backend.yml
  - compose/frontend.yml

  # Note: Infrastructure (MongoDB, Redis, Qdrant) is SHARED across all environments
  # Start infrastructure once with: docker compose -f ../../compose/infrastructure-shared.yml up -d
  # Each environment connects to shared infrastructure using unique database names

  # Note: Caddy is SHARED across all environments
  # Start Caddy once with: docker compose -f ../../compose/caddy.yml up -d
  # Caddy serves all environments via path-based routing

  # Note: Mycelia moved to root level (../../compose/mycelia.yml)
  # To use Mycelia, run from project root: docker compose --profile mycelia up

  # Development overrides (default)
  - compose/overrides/dev.yml

# Shared network configuration
networks:
  chronicle-network:
    name: chronicle-network
    external: true

# Shared volume configuration
volumes:
  mongo_data:
    driver: local
  caddy_data:
    driver: local
  caddy_config:
    driver: local
  ollama_data:
    driver: local
  neo4j_data:
    driver: local
  neo4j_logs:
    driver: local
